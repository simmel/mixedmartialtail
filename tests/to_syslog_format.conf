input {
  stdin {}
}

filter {

  # This "looks like" JSON
  if [message] =~ /^{\s*?".*["0-9\}\]el]\s*?}$/ {
    json {
      source => "message"
    }
  }

  # This is syslog
  else {
    grok {
      match => {
        "message" => "%{COMBINEDAPACHELOG}"
      }
    }
  }

  date {
    match => [
      "timestamp",
      "dd/MMM/YYYY:HH:mm:ss Z"
    ]
  }

}

output {
  stdout {
    codec => line {
      format => "%{@timestamp} %{host} %{message}"
    }
  }
}
